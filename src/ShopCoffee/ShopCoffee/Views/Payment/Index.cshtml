@model IEnumerable<ShopCoffee.Database.Payment>

<div style="height: 120px"></div>
<div class="container py-5">
    <h3 class="mb-4 fw-bold">Lịch sử thanh toán</h3>

    <table class="table table-bordered table-hover align-middle shadow-sm">
        <thead class="table-primary">
            <tr>
                <th>#</th>
                <th>Ngày thanh toán</th>
                <th>Tổng tiền</th>
                <th width="50"></th>
            </tr>
        </thead>
        <tbody>
            @{
                int index = 1;
            }
            @foreach (var item in Model)
            {
                var collapseId = $"collapse_{item.PaymentId}";
                <tr class="payment-row table-primary"
                    data-bs-toggle="collapse"
                    data-bs-target="#@collapseId"
                    aria-expanded="false">
                    <td>#@index</td>
                    <td>@item.CreateAt.ToString("dd/MM/yyyy HH:mm")</td>
                    <td class="fw-semibold">@item.Total?.ToString("N0") đ</td>
                    <td><span class="toggle-icon">▶</span></td>
                </tr>

                <tr>
                    <td colspan="4" class="p-0">
                        <div id="@collapseId" class="collapse">
                            <div class="details-box">
                                <table class="table table-sm table-striped mb-0">
                                    <thead class="table-info">
                                        <tr>
                                            <th>Sản phẩm</th>
                                            <th>SL</th>
                                            <th>Giá</th>
                                            <th>Thành tiền</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var d in item.PaymentDetails)
                                        {
                                            <tr>
                                                <td>@d.Product?.Title</td>
                                                <td>@d.Quantity</td>
                                                <td>@d.Price?.ToString("N0") đ</td>
                                                <td>@d.Total?.ToString("N0") đ</td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </td>
                </tr>

                index++;
            }
        </tbody>
    </table>
</div>



<style>
    .payment-row {
        cursor: pointer;
        transition: background 0.2s ease;
    }

        .payment-row:hover {
            background: #f5f5f5 !important;
        }

    .toggle-icon {
        transition: transform 0.25s ease;
        font-size: 12px;
    }

    .details-box {
        background: #fafafa;
        padding: 10px;
        border-radius: 4px;
    }

    /* icon xoay khi mở */
    .payment-row[aria-expanded="true"] .toggle-icon {
        transform: rotate(90deg);
    }
</style>
